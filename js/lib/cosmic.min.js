var cosmic=function(t,i,e,n){"use strict";var o={};return o.hub=e.Events,o.environment=function(t,i){var e={},n=1.82;return e.objects=[],e.planets=[],e.bodies=[],e.bounds={width:800,height:600},e.addBody=function(t){this.addObject(t,"body")},e.addPlanet=function(t){this.addObject(t,"planet")},e.addObject=function(o,s){e.objects.push(o),"planet"===s?(e.planets.push(o),i.each(e.bodies,function(i){t.gravity.planetary(i,o,n)})):"body"===s&&(e.bodies.push(o),i.each(e.planets,function(i){t.gravity.planetary(o,i,n)}))},e.advance=function(t){i.each(e.objects,function(e){i.isFunction(e.advance)&&e.advance(t)}),i.each(e.objects,function(t,n){if(i.isFunction(t.collision))for(var o=n+1;e.objects.length>o;o+=1)t.collision(e.objects[o])}),i.each(e.objects,function(t){e.outOfBounds(t)}),i.each(e.objects,function(t){i.isFunction(t.pathRun)&&t.options.pathTime&&o.time-t.options.pathTime>7e3&&t.pathRun(1e4,100,o.time)})},e.outOfBounds=function(t){-10>t.x?t.x=e.bounds.width+10:t.x>e.bounds.width+10&&(t.x=-10),-10>t.y?t.y=e.bounds.height+10:t.y>e.bounds.height+10&&(t.y=-10)},e}(freebody,i),o.CameraBase=function(t,i){var e=function(){this.position={x:0,y:0},this.scale=1,this.initSize={x:800,y:600},this.viewSize={x:this.initSize.x/this.scale,y:this.initSize.y/this.scale},this._layers={},this.following=null};return e.prototype.render=function(i){var e=this;i?e.renderLayer.call(e,i):t.each(t.keys(e._layers),e.renderLayer,e)},e.prototype.renderLayer=function(){throw Error("render layer function for CameraBase implementation must be defined")},e.prototype.layer=function(i,e){return t.isUndefined(e)?this._layers[i]:(this._layers[i]=e,n)},e.prototype.drawMatter=function(i){i&&t.isFunction(i.draw)&&(this.following&&(this.position.x=this.following.x-400/this.scale,this.position.y=this.following.y-300/this.scale),i.draw(this.position,this.scale))},e.prototype.follow=function(t){console.log("called"),this.following=t,console.log(this.following)},e.prototype.stopFollow=function(){this.following=null},e.prototype.center=function(t){this.following=null,t?(this.position.x=t.x-this.viewSize.x/2,this.position.y=t.y-this.viewSize.y/2):(this.position.x=i.bounds.width/2-this.viewSize.x/2,this.position.y=i.bounds.height/2-this.viewSize.y/2)},e.prototype.reset=function(){this.position.x=this.defaults.position.x,this.position.y=this.defaults.position.y,this.scale=this.defaults.scale,this.following=this.defaults.following},e.prototype.zoom=function(t){var i={},e={x:this.position.x+this.viewSize.x/2,y:this.position.y+this.viewSize.y/2};this.scale=t,i.x=this.initSize.x/t,i.y=this.initSize.y/t,console.log(this.position.x+this.viewSize.x/2),this.position.x=e.x-i.x/2,this.position.y=e.y-i.y/2,console.log(this.position.x+this.viewSize.x/2),this.viewSize.x=i.x,this.viewSize.y=i.y},e}(i,o.environment),o.collisions=function(t,i){var e={},s=t.utils;e.centerDistance={setBounding:function(t,i){d(t,{radius:i})},methods:{checkCollision:function(t){var i=s.distance(this,t),e=d(this).radius+d(t).radius;return e>=i?("Destination"!=this.options.type&&"Destination"!=t.options.type&&h(t,this),"Planet"==this.options.type&&"Planet"==t.options.type&&o.reset(),!0):n}}},e.boundingBox={setBounding:function(t,i,e,n,o){r(t,i,e,n,o)},methods:{checkCollision:function(t){var n=this;return e.centerDistance.checkCollision.call(n,t)?!!i.find(r(t),function(t){return c(t,n)}):!1}}},e.utils={};var r=e.utils.boundingBox=function(t,e,n,o,s){return i.isUndefined(e)||(d(t,{box:{width:e,height:n,offsetLength:o,theta:s}}),d(t,{radius:u(t)})),a(t)},a=e.utils.boundingBoxPoints=function(t){var i,e=d(t).box,n=e.theta+t.angle,o=[];return i=s.relativePoint(t,n,e.offsetLength),o[0]=s.relativePoint(i,n-90,e.width/2),o[3]=s.relativePoint(i,n+90,e.width/2),o[1]=s.relativePoint(o[0],n-180,e.height),o[2]=s.relativePoint(o[3],n-180,e.height),o},u=e.utils.boundingRadiusFromBox=function(t){for(var i=a(t),e=0,n=0;i.length>n;n+=1){var o=s.distance(i[n],t);o>e&&(e=o)}return e},c=e.utils.pointIsInsideMatter=function(t,i){var e=d(i).box,o=s.distance(t,i),r=s.angle(i,t);r-=e.theta+i.angle;var a=s.relativePoint(n,r,o),u=e.offsetLength-e.height,c=e.offsetLength,h=e.width/2,l=-e.width/2;return a.x>=u&&c>=a.x&&a.y>=l&&h>=a.y},h=function(t,i){var e=s.angle(t,i),n=e+(e-t.v.angle())-180,o=e+(e-i.v.angle())-180,r=Math.abs((t.v.magnitude()*(t.mass-i.mass)+2*i.mass*i.v.magnitude())/(t.mass+i.mass)),a=Math.abs((i.v.magnitude()*(i.mass-t.mass)+2*t.mass*t.v.magnitude())/(t.mass+i.mass));t.v.magnitude()>0&&(t.v.angle(n>360?n-360:n),t.v.magnitude(r)),i.v.magnitude()>0&&(i.v.angle(o>360?o-360:o),i.v.magnitude(a))},l="_bounding",d=e.utils.bounding=function(t,e){return i.isUndefined(e)?i.isUndefined(t[l])&&(t[l]={}):t[l]=i.extend(t[l]||{},e),t[l]};return e}(freebody,i),o.Matter=function(t,i,e){var n=function(i){var e=this;return e.angle=0,t.Body.call(e,i),e};return i.extend(n.prototype,t.Body.prototype,e.Events,{collision:function(t){var e=this;return i.isFunction(e.checkCollision)&&e.checkCollision(t)?(e.collide(t),t.collide(e),!0):!1},collide:function(){}}),n}(freebody,i,e),o.gamePiece=function(t,i,e){var n=function(){var n=this,o=function(i){return this.options=e.defaults(i,o.defaults),t.call(this,this.options),this.display=this._create.call(this),e.isFunction(this._setBounding)&&this._setBounding.call(this),this._setupEvents(),this};return e.extend(o.prototype,t.prototype),n.defaults=function(t){return o.defaults=t,n},n.methods=function(t){return e.extend(o.prototype,t),n},n.display=function(t){return o.prototype._create=t,n},n.events=function(t){return o.prototype._setupEvents=function(){var i=this;e.each(t,function(t,n){e.isString(t)&&(t=i[t]),i.on(n,t)})},n},n.collisions=function(t,s){var r=i[t];return r&&e.extend(o.prototype,r.methods,{_setBounding:function(){s.call(this,r.setBounding)}}),n},n.construct=function(){return o},n.create=function(t){return new n.construct(t)},n};return n}(o.Matter,o.collisions,i,Kinetic),o.KineticCamera=function(t,i,e){var s=function(i,n){t.call(this),this.stage=new e.Stage({container:i,width:n&&n.width||800,height:n&&n.height||600}),this._displayLayers={},r.call(this)};i.extend(s.prototype,t.prototype,{renderLayer:function(t){var e=this,n=e._layers[t],o=e._displayLayers[t];n&&(o||(o=e._addLayer(t)),i.each(n,function(t){e._addObjectToLayer(t,o),e.drawMatter(t)}),o.draw())},_addLayer:function(t){var i=new e.Layer;return i.name=t,this._displayLayers[t]=i,this.stage.add(i),i},_addObjectToLayer:function(t,i){t.display.layer!=i.name&&(i.add(t.display),t.display.layer=i.name)}});var r=function(){var t,i;if(this.stage){var s=new e.Rect({width:this.stage.attrs.width,height:this.stage.attrs.height,opacity:0});s.isTrackingLayer=!0,this.layer("tracking",[{display:s}]);var r=function(e){var n=a(e);n&&n.underlying&&n.underlying.trigger&&(n.underlying.trigger("touchstart",e),o.selected=i=n),o.hub.trigger("touchstart",e,i),t=!0},u=function(e){t&&(i&&i.underlying&&i.underlying.trigger&&i.underlying.trigger("touchmove",e),o.hub.trigger("touchmove",e,i))},c=function(e){i&&i.underlying&&i.underlying.trigger&&i.underlying.trigger("touchend",e),o.hub.trigger("touchend",e),o.selected=i=n,t=!1};this.stage.on("mousedown",r),this.stage.on("mousemove",u),this.stage.on("mouseup",c)}},a=function(t){var i=t&&t.targetNode;if(i)for(;"Layer"!=i.parent.nodeType;)i=i.parent;return i};return s}(o.CameraBase,i,Kinetic),o.playback=function(t,i){var e,s=t.requestAnimationFrame,r={progress:!1,render:!1,physics:!1},a=!1,u={};return u.progress=function(t){r.progress||(e=s(u.progress)),r.physics||(o.environment.advance(t-(o.time||t)),o.time=t),r.render||o.camera===n||(i.trigger("playback:render:before"),o.camera.render(),i.trigger("playback:render"))},u.start=function(t){t||u.unpause(),u.progress(),a=!0,i.trigger("playback:start")},u.step=function(t){r.progress=!0,o.time===n&&(o.time=+new Date),t=t!==n?t:1e3/60,u.progress(o.time+t),i.trigger("playback:step")},u.pause=function(t){t&&(r.progress=!0,r.render=!0),r.physics=!0,i.trigger("playback:pause")},u.unpause=function(t){t&&(r.progress=!1,r.render=!1),r.physics=!1,i.trigger("playback:unpause")},u.stop=function(){e&&t.cancelAnimationFrame(e),o.time=n,a=!1,i.trigger("playback:stop")},u}(this||window,o.hub),o}(this||window,_,Backbone);