var cosmic=function(t,e,i,n){"use strict";var o={};return o.hub=i.Events,o.environment=function(t,e){var i={},n=1.82;return i.objects=[],i.planets=[],i.bodies=[],i.bounds={width:800,height:600},i.addBody=function(t){this.addObject(t,"body")},i.addPlanet=function(t){this.addObject(t,"planet")},i.addObject=function(o,s){i.objects.push(o),"planet"===s?(i.planets.push(o),e.each(i.bodies,function(e){t.gravity.planetary(e,o,n)})):"body"===s&&(i.bodies.push(o),e.each(i.planets,function(e){t.gravity.planetary(o,e,n)}))},i.advance=function(t){e.each(i.objects,function(i){e.isFunction(i.advance)&&i.advance(t)}),e.each(i.objects,function(t,n){if(e.isFunction(t.collision))for(var o=n+1;i.objects.length>o;o+=1)t.collision(i.objects[o])}),e.each(i.objects,function(t){i.outOfBounds(t)}),e.each(i.objects,function(t){e.isFunction(t.pathRun)&&t.options.pathTime&&o.time-t.options.pathTime>7e3&&t.pathRun(1e4,100,o.time)})},i.outOfBounds=function(t){-10>t.x?t.x=i.bounds.width+10:t.x>i.bounds.width+10&&(t.x=-10),-10>t.y?t.y=i.bounds.height+10:t.y>i.bounds.height+10&&(t.y=-10)},i}(freebody,e),o.CameraBase=function(t,e){var i=function(){this.position={x:0,y:0},this.scale=1,this.initSize={x:800,y:600},this.viewSize={x:this.initSize.x/this.scale,y:this.initSize.y/this.scale},this._layers={},this.following=null};return i.prototype.render=function(e){var i=this;e?i.renderLayer.call(i,e):t.each(t.keys(i._layers),i.renderLayer,i)},i.prototype.renderLayer=function(){throw Error("render layer function for CameraBase implementation must be defined")},i.prototype.layer=function(e,i){return t.isUndefined(i)?this._layers[e]:(this._layers[e]=i,n)},i.prototype.drawMatter=function(e){e&&t.isFunction(e.draw)&&(this.following&&(this.position.x=this.following.x-400/this.scale,this.position.y=this.following.y-300/this.scale),e.draw(this.position,this.scale))},i.prototype.follow=function(t){console.log("called"),this.following=t,console.log(this.following)},i.prototype.stopFollow=function(){this.following=null},i.prototype.center=function(t){this.following=null,t?(this.position.x=t.x-this.viewSize.x/2,this.position.y=t.y-this.viewSize.y/2):(this.position.x=e.bounds.width/2-this.viewSize.x/2,this.position.y=e.bounds.height/2-this.viewSize.y/2)},i.prototype.reset=function(){this.position.x=this.defaults.position.x,this.position.y=this.defaults.position.y,this.scale=this.defaults.scale,this.following=this.defaults.following},i.prototype.zoom=function(t){var e={},i={x:this.position.x+this.viewSize.x/2,y:this.position.y+this.viewSize.y/2};this.scale=t,e.x=this.initSize.x/t,e.y=this.initSize.y/t,console.log(this.position.x+this.viewSize.x/2),this.position.x=i.x-e.x/2,this.position.y=i.y-e.y/2,console.log(this.position.x+this.viewSize.x/2),this.viewSize.x=e.x,this.viewSize.y=e.y},i}(e,o.environment),o.collisions=function(t,e){var i={},s=t.utils;i.centerDistance={setBounding:function(t,e){d(t,{radius:e})},methods:{checkCollision:function(t){var e=s.distance(this,t),i=d(this).radius+d(t).radius;return i>=e?("Destination"!=this.options.type&&"Destination"!=t.options.type&&h(t,this),"Planet"==this.options.type&&"Planet"==t.options.type&&o.reset(),!0):n}}},i.boundingBox={setBounding:function(t,e,i,n,o){r(t,e,i,n,o)},methods:{checkCollision:function(t){var n=this;return i.centerDistance.checkCollision.call(n,t)?!!e.find(r(t),function(t){return u(t,n)}):!1}}},i.utils={};var r=i.utils.boundingBox=function(t,i,n,o,s){return e.isUndefined(i)||(d(t,{box:{width:i,height:n,offsetLength:o,theta:s}}),d(t,{radius:c(t)})),a(t)},a=i.utils.boundingBoxPoints=function(t){var e,i=d(t).box,n=i.theta+t.angle,o=[];return e=s.relativePoint(t,n,i.offsetLength),o[0]=s.relativePoint(e,n-90,i.width/2),o[3]=s.relativePoint(e,n+90,i.width/2),o[1]=s.relativePoint(o[0],n-180,i.height),o[2]=s.relativePoint(o[3],n-180,i.height),o},c=i.utils.boundingRadiusFromBox=function(t){for(var e=a(t),i=0,n=0;e.length>n;n+=1){var o=s.distance(e[n],t);o>i&&(i=o)}return i},u=i.utils.pointIsInsideMatter=function(t,e){var i=d(e).box,o=s.distance(t,e),r=s.angle(e,t);r-=i.theta+e.angle;var a=s.relativePoint(n,r,o),c=i.offsetLength-i.height,u=i.offsetLength,h=i.width/2,l=-i.width/2;return a.x>=c&&u>=a.x&&a.y>=l&&h>=a.y},h=function(t,e){var i=s.angle(t,e),n=i+(i-t.v.angle())-180,o=i+(i-e.v.angle())-180,r=Math.abs((t.v.magnitude()*(t.mass-e.mass)+2*e.mass*e.v.magnitude())/(t.mass+e.mass)),a=Math.abs((e.v.magnitude()*(e.mass-t.mass)+2*t.mass*t.v.magnitude())/(t.mass+e.mass));t.v.magnitude()>0&&(t.v.angle(n>360?n-360:n),t.v.magnitude(r)),e.v.magnitude()>0&&(e.v.angle(o>360?o-360:o),e.v.magnitude(a))},l="_bounding",d=i.utils.bounding=function(t,i){return e.isUndefined(i)?e.isUndefined(t[l])&&(t[l]={}):t[l]=e.extend(t[l]||{},i),t[l]};return i}(freebody,e),o.Matter=function(t,e,i){var n=function(e){var i=this;return i.angle=0,t.Body.call(i,e),i};return e.extend(n.prototype,t.Body.prototype,i.Events,{collision:function(t){var i=this;return e.isFunction(i.checkCollision)&&i.checkCollision(t)?(i.collide(t),t.collide(i),!0):!1},collide:function(){}}),n}(freebody,e,i),o.gamePiece=function(t,e,i){var n=function(){var n=this,o=function(e){return this.options=i.defaults(e,o.defaults),t.call(this,this.options),this.display=this._create.call(this),this.display.underlying=this,i.isFunction(this._setBounding)&&this._setBounding.call(this),this._setupEvents(),this};return i.extend(o.prototype,t.prototype),n.defaults=function(t){return o.defaults=t,n},n.methods=function(t){return i.extend(o.prototype,t),n},n.display=function(t){return o.prototype._create=t,n},n.events=function(t){return o.prototype._setupEvents=function(){var e=this;i.each(t,function(t,n){i.isString(t)&&(t=e[t]),e.on(n,t)})},n},n.collisions=function(t,s){var r=e[t];return r&&i.extend(o.prototype,r.methods,{_setBounding:function(){s.call(this,r.setBounding)}}),n},n.construct=function(){return o},n.create=function(t){return new n.construct(t)},n};return n}(o.Matter,o.collisions,e,Kinetic),o.KineticCamera=function(t,e,i){var s=function(e,n){t.call(this),this.stage=new i.Stage({container:e,width:n&&n.width||800,height:n&&n.height||600}),this._displayLayers={},this._setupTracking()};e.extend(s.prototype,t.prototype,{renderLayer:function(t){var i=this,n=i._layers[t],o=i._displayLayers[t];n&&(o||(o=i._addLayer(t)),e.each(n,function(t){i._addObjectToLayer(t,o),i.drawMatter(t)}),o.draw())},_addLayer:function(t){var e=new i.Layer;return e.name=t,this._displayLayers[t]=e,this.stage.add(e),e},_addObjectToLayer:function(t,e){t.display.layer!=e.name&&(e.add(t.display),t.display.layer=e.name)},_setupTracking:function(){var t,e,i,s=this;if(s.stage){var a=function(i){var n=r(i),s=n.underlying;o.hub.trigger("touchstart",i,s),!i.handled&&s&&(s.trigger("touchstart",i),o.selected=e=s),t=!0},c=function(i){t&&(o.hub.trigger("touchmove",i,e),!i.handled&&e&&e.trigger("touchmove",i))},u=function(i){o.hub.trigger("touchend",i,e),!i.handled&&e&&e.trigger("touchend",i),o.selected=e=n,t=!1};s.stage.on("mousedown",a),s.stage.on("mousemove",c),s.stage.on("mouseup",u)}document.addEventListener("mousewheel",function(t){o.hub.trigger("zoom",t.wheelDeltaY/1440)},!0),o.hub.on("touchstart",function(t,e){if(e&&t.ctrlKey&&t.shiftKey)s.follow(e),t.handled=!0;else if(t.ctrlKey&&!t.shiftKey){s.following=n;var o=s.position.x,r=s.position.y;s.position.x=t.layerX/s.scale+o-400/s.scale,s.position.y=t.layerY/s.scale+r-300/s.scale,t.handled=!0}else t.shiftKey&&!t.ctrlKey&&(i={x:t.layerX,y:t.layerY},t.handled=!0)}),o.hub.on("touchmove",function(t){i!==n&&t.shiftKey&&s&&(s.position.x+=(i.x-t.layerX)/s.scale,s.position.y+=(i.y-t.layerY)/s.scale,i.x=t.layerX,i.y=t.layerY,t.handled=!0)}),o.hub.on("touchend",function(){i=n}),o.hub.on("zoom",function(t){var e=s.scale*(1+t);e>.15&&2>e&&s.zoom(e)})}});var r=function(t){var e=t&&t.targetNode;if(e)for(;"Layer"!=e.parent.nodeType;)e=e.parent;return e};return s}(o.CameraBase,e,Kinetic),o.playback=function(t,e){var i,s=t.requestAnimationFrame,r={progress:!1,render:!1,physics:!1},a=!1,c={};return c.progress=function(t){r.progress||(i=s(c.progress)),r.physics||(e.trigger("playback:advance:before"),o.environment.advance(t-(o.time||t)),o.time=t,e.trigger("playback:advance")),r.render||o.camera===n||(e.trigger("playback:render:before"),o.camera.render(),e.trigger("playback:render"))},c.start=function(t){t||c.unpause(),c.progress(),a=!0,e.trigger("playback:start")},c.step=function(t){r.progress=!0,o.time===n&&(o.time=+new Date),t=t!==n?t:1e3/60,c.progress(o.time+t),e.trigger("playback:step")},c.pause=function(t){t?(t.progress!==n&&(r.progress=t.progress),t.render!==n&&(r.render=t.render),r.physics=t.physics!==n?t.physics:!0):r.physics=!0,e.trigger("playback:pause")},c.unpause=function(t){t?(t.progress!==n&&(r.progress=t.progress),t.render!==n&&(r.render=t.render),r.physics=t.physics!==n?t.physics:!1):r.physics=!1,o.time=+new Date,e.trigger("playback:unpause")},c.stop=function(){i&&t.cancelAnimationFrame(i),o.time=n,a=!1,e.trigger("playback:stop")},c}(this||window,o.hub),o}(this||window,_,Backbone);