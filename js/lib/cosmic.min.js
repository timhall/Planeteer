var cosmic=function(t,e,i,n){"use strict";var o={};o.environment=function(t,e){var i={},n=1.82;return i.objects=[],i.planets=[],i.bodies=[],i.paused=!1,i.bounds={width:800,height:600},i.addBody=function(t){this.addObject(t,"body")},i.addPlanet=function(t){this.addObject(t,"planet")},i.addDestination=function(t){this.addObject(t,"destination")},i.addObject=function(o,s){i.objects.push(o),"planet"==s?(i.planets.push(o),e.each(i.bodies,function(e){t.gravity.planetary(e,o,n)})):"body"==s&&(i.bodies.push(o),e.each(i.planets,function(e){t.gravity.planetary(o,e,n)}))},i.advance=function(t){0==this.paused&&(e.each(i.objects,function(i){e.isFunction(i.advance)&&i.advance(t)}),e.each(i.objects,function(t,n){if(e.isFunction(t.collision))for(var o=n+1;i.objects.length>o;o+=1)t.collision(i.objects[o])}),e.each(i.objects,function(t){i.outOfBounds(t)}),e.each(i.objects,function(t){e.isFunction(t.pathRun)&&t.options.pathTime&&o.time-t.options.pathTime>7e3&&t.pathRun(1e4,100,o.time)}))},i.outOfBounds=function(t){-10>t.x?t.x=i.bounds.width+10:t.x>i.bounds.width+10&&(t.x=-10),-10>t.y?t.y=i.bounds.height+10:t.y>i.bounds.height+10&&(t.y=-10)},i}(freebody,e),o.CameraBase=function(t,e){var i=function(){this.position={x:0,y:0},this.scale=1,this.initSize={x:800,y:600},this.viewSize={x:this.initSize.x/this.scale,y:this.initSize.y/this.scale},this._layers={},this.following=null};return i.prototype.render=function(e){var i=this;e?i.renderLayer.call(i,e):t.each(t.keys(i._layers),i.renderLayer,i)},i.prototype.renderLayer=function(){throw Error("render layer function for CameraBase implementation must be defined")},i.prototype.layer=function(e,i){return t.isUndefined(i)?this._layers[e]:(this._layers[e]=i,n)},i.prototype.drawMatter=function(e){e&&t.isFunction(e.draw)&&(this.following&&(this.position.x=this.following.x-400/this.scale,this.position.y=this.following.y-300/this.scale),e.draw(this.position,this.scale))},i.prototype.follow=function(t){console.log("called"),this.following=t,console.log(this.following)},i.prototype.stopFollow=function(){this.following=null},i.prototype.center=function(t){this.following=null,t?(this.position.x=t.x-this.viewSize.x/2,this.position.y=t.y-this.viewSize.y/2):(this.position.x=e.bounds.width/2-this.viewSize.x/2,this.position.y=e.bounds.height/2-this.viewSize.y/2)},i.prototype.reset=function(){this.position.x=this.defaults.position.x,this.position.y=this.defaults.position.y,this.scale=this.defaults.scale,this.following=this.defaults.following},i.prototype.zoom=function(t){var e={},i={x:this.position.x+this.viewSize.x/2,y:this.position.y+this.viewSize.y/2};this.scale=t,e.x=this.initSize.x/t,e.y=this.initSize.y/t,console.log(this.position.x+this.viewSize.x/2),this.position.x=i.x-e.x/2,this.position.y=i.y-e.y/2,console.log(this.position.x+this.viewSize.x/2),this.viewSize.x=e.x,this.viewSize.y=e.y},i}(e,o.environment),o.collisions=function(t,e){var i={},s=t.utils;i.centerDistance={setBounding:function(t,e){d(t,{radius:e})},methods:{checkCollision:function(t){var e=s.distance(this,t),i=d(this).radius+d(t).radius;return i>=e?("Destination"!=this.options.type&&"Destination"!=t.options.type&&u(t,this),"Planet"==this.options.type&&"Planet"==t.options.type&&o.reset(),!0):n}}},i.boundingBox={setBounding:function(t,e,i,n,o){a(t,e,i,n,o)},methods:{checkCollision:function(t){var n=this;return i.centerDistance.checkCollision.call(n,t)?!!e.find(a(t),function(t){return l(t,n)}):!1}}},i.utils={};var a=i.utils.boundingBox=function(t,i,n,o,s){return e.isUndefined(i)||(d(t,{box:{width:i,height:n,offsetLength:o,theta:s}}),d(t,{radius:c(t)})),r(t)},r=i.utils.boundingBoxPoints=function(t){var e,i=d(t).box,n=i.theta+t.angle,o=[];return e=s.relativePoint(t,n,i.offsetLength),o[0]=s.relativePoint(e,n-90,i.width/2),o[3]=s.relativePoint(e,n+90,i.width/2),o[1]=s.relativePoint(o[0],n-180,i.height),o[2]=s.relativePoint(o[3],n-180,i.height),o},c=i.utils.boundingRadiusFromBox=function(t){for(var e=r(t),i=0,n=0;e.length>n;n+=1){var o=s.distance(e[n],t);o>i&&(i=o)}return i},l=i.utils.pointIsInsideMatter=function(t,e){var i=d(e).box,o=s.distance(t,e),a=s.angle(e,t);a-=i.theta+e.angle;var r=s.relativePoint(n,a,o),c=i.offsetLength-i.height,l=i.offsetLength,u=i.width/2,h=-i.width/2;return r.x>=c&&l>=r.x&&r.y>=h&&u>=r.y},u=function(t,e){var i=s.angle(t,e),n=i+(i-t.v.angle())-180,o=i+(i-e.v.angle())-180,a=Math.abs((t.v.magnitude()*(t.mass-e.mass)+2*e.mass*e.v.magnitude())/(t.mass+e.mass)),r=Math.abs((e.v.magnitude()*(e.mass-t.mass)+2*t.mass*t.v.magnitude())/(t.mass+e.mass));t.v.magnitude()>0&&(t.v.angle(n>360?n-360:n),t.v.magnitude(a)),e.v.magnitude()>0&&(e.v.angle(o>360?o-360:o),e.v.magnitude(r))},h="_bounding",d=i.utils.bounding=function(t,i){return e.isUndefined(i)?e.isUndefined(t[h])&&(t[h]={}):t[h]=e.extend(t[h]||{},i),t[h]};return i}(freebody,e),o.Matter=function(t,e,i){var n=function(e){var i=this;return i.angle=0,t.Body.call(i,e),i};return e.extend(n.prototype,t.Body.prototype,i.Events,{collision:function(t){var i=this;return e.isFunction(i.checkCollision)&&i.checkCollision(t)?(i.collide(t),t.collide(i),!0):!1},collide:function(){}}),n}(freebody,e,i),o.gamePiece=function(t,e,i){var n=function(){var n=this,o=function(e){return this.options=i.defaults(e,o.defaults),t.call(this,this.options),this.display=this._create.call(this),i.isFunction(this._setBounding)&&this._setBounding.call(this),this._setupEvents(),this};return i.extend(o.prototype,t.prototype),n.defaults=function(t){return o.defaults=t,n},n.methods=function(t){return i.extend(o.prototype,t),n},n.display=function(t){return o.prototype._create=t,n},n.events=function(t){return o.prototype._setupEvents=function(){var e=this;i.each(t,function(t,n){i.isString(t)&&(t=e[t]),e.on(n,t)})},n},n.collisions=function(t,s){var a=e[t];return a&&i.extend(o.prototype,a.methods,{_setBounding:function(){s.call(this,a.setBounding)}}),n},n.construct=function(){return o},n.create=function(t){return new n.construct(t)},n};return n}(o.Matter,o.collisions,e,Kinetic),o.KineticCamera=function(t,e,i){var s=function(e,n){t.call(this),this.stage=new i.Stage({container:e,width:n&&n.width||800,height:n&&n.height||600}),this._displayLayers={},this._initTracking()};return e.extend(s.prototype,t.prototype,{renderLayer:function(t){var i=this,n=i._layers[t],o=i._displayLayers[t];n&&(o||(o=i._addLayer(t)),e.each(n,function(t){i._addObjectToLayer(t,o),i.drawMatter(t)}),o.draw())},_addLayer:function(t){var e=new i.Layer;return e.name=t,this._displayLayers[t]=e,this.stage.add(e),e},_addObjectToLayer:function(t,e){t.display.layer!=e.name&&(e.add(t.display),t.display.layer=e.name)},_initTracking:function(){if(this.stage){var t=new i.Rect({width:this.stage.attrs.width,height:this.stage.attrs.height,opacity:1,fill:"#FFFFFFF"});t.isTracking=!0,this.layer("tracking",[{display:t}]);var e,s,a={x:0,y:0};this.stage.on("mousedown",function(t){var i=r(t);if(console.log(t),i.isTracking||t.ctrlKey||t.shiftKey||(o.pausePhysics(),e=i,i.select?i.select(t):o.selected=null),t.ctrlKey&&!t.shiftKey){o.camera.following=null;var n=o.camera.position.x,c=o.camera.position.y;o.camera.position.x=t.layerX/o.camera.scale+n-400/o.camera.scale,o.camera.position.y=t.layerY/o.camera.scale+c-300/o.camera.scale}t.shiftKey&&(o.camera.following=null,s=!0,a.x=t.layerX,a.y=t.layerY),t.shiftKey&&t.ctrlKey&&(console.log(i),e=i,e.followClick(t),i.select&&i.select(t))}),this.stage.on("mousemove",function(t){e&&!t.shiftKey&&e.move(t),t.shiftKey&&s&&(o.camera.position.x+=(a.x-t.layerX)/o.camera.scale,o.camera.position.y+=(a.y-t.layerY)/o.camera.scale,a.x=t.layerX,a.y=t.layerY)}),this.stage.on("mouseup",function(){e=s=n,o.unpause()}),document.addEventListener("mousewheel",function(t){o.camera.scale+t.wheelDeltaY/1440>.15&&2>o.camera.scale+t.wheelDeltaY/1440&&o.camera.zoom(o.camera.scale+o.camera.scale*t.wheelDeltaY/1440)},!0)}var r=function(t){var e=t&&t.targetNode;if(e)for(;"Layer"!=e.parent.nodeType;)e=e.parent;return e}}}),s}(o.CameraBase,e,Kinetic);var s=window.requestAnimationFrame,a=!1,r=!1;return o.start=function(){o.unpause(),o.progress()},o.startRendering=function(){o.unpause(),o.pausePhysics(),o.progress()},o.progress=function(t){a||(s(o.progress),r||o.environment.advance(t-(o.time||t)),o.time=t,o.beforeRender&&o.beforeRender(),o.camera&&o.camera.render())},o.reset=function(){e.each(o.environment.objects,function(t){t.x=Math.floor(1400*Math.random()+100),t.y=Math.floor(1200*Math.random()+100),o.camera.reset(),o.iteration+=1,console.log(o.iteration)})},o.pause=function(){a=!0},o.pausePhysics=function(){r=!0},o.unpause=function(){a=!1,r=!1,e.each(environment.objects,function(t){t.pathRun&&t.pathRun(1e4,100,o.time)})},o.step=function(){o.start(),o.pause()},o}(this,_,Backbone);