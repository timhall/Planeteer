var cosmic=function(t,e,i,n){"use strict";var o={};return o.hub=i.Events,o.environment=function(t,e){var i={},n=1.82;return i.objects=[],i.planets=[],i.bodies=[],i.bounds={width:800,height:600},i.addBody=function(t){this.addObject(t,"body")},i.addPlanet=function(t){this.addObject(t,"planet")},i.addObject=function(o,s){i.objects.push(o),"planet"===s?(i.planets.push(o),e.each(i.bodies,function(e){t.gravity.planetary(e,o,n)})):"body"===s&&(i.bodies.push(o),e.each(i.planets,function(e){t.gravity.planetary(o,e,n)}))},i.advance=function(t){e.each(i.objects,function(i){e.isFunction(i.advance)&&i.advance(t)}),e.each(i.objects,function(t,n){if(e.isFunction(t.collision))for(var o=n+1;i.objects.length>o;o+=1)t.collision(i.objects[o])}),e.each(i.objects,function(t){i.outOfBounds(t)}),e.each(i.objects,function(t){e.isFunction(t.pathRun)&&t.options.pathTime&&o.time-t.options.pathTime>7e3&&t.pathRun(1e4,100,o.time)})},i.outOfBounds=function(t){-10>t.x?t.x=i.bounds.width+10:t.x>i.bounds.width+10&&(t.x=-10),-10>t.y?t.y=i.bounds.height+10:t.y>i.bounds.height+10&&(t.y=-10)},i}(freebody,e),o.CameraBase=function(t,e){var i=function(){this.position={x:0,y:0},this.scale=1,this.initSize={x:1e3,y:750},this.viewSize={x:this.initSize.x/this.scale,y:this.initSize.y/this.scale},this._layers={},this.following=null};return i.prototype.render=function(e){var i=this;e?i.renderLayer.call(i,e):t.each(t.keys(i._layers),i.renderLayer,i),o.hub.trigger("camera:render")},i.prototype.renderLayer=function(){throw Error("render layer function for CameraBase implementation must be defined")},i.prototype.layer=function(e,i){return t.isUndefined(i)?this._layers[e]:(this._layers[e]=i,n)},i.prototype.drawMatter=function(e){e&&t.isFunction(e.draw)&&(this.following&&(this.position.x=this.following.x-400/this.scale,this.position.y=this.following.y-300/this.scale,o.hub.trigger("camera:follow")),e.draw(this.position,this.scale))},i.prototype.follow=function(t){this.following=t},i.prototype.stopFollow=function(){this.following=null},i.prototype.center=function(t){this.following=null,t?(this.position.x=t.x-this.viewSize.x/2,this.position.y=t.y-this.viewSize.y/2):(this.position.x=e.bounds.width/2-this.viewSize.x/2,this.position.y=e.bounds.height/2-this.viewSize.y/2)},i.prototype.reset=function(){this.position.x=this.defaults.position.x,this.position.y=this.defaults.position.y,this.scale=this.defaults.scale,this.following=this.defaults.following},i.prototype.zoom=function(t){var e={},i={x:this.position.x+this.viewSize.x/2,y:this.position.y+this.viewSize.y/2};this.scale=t,e.x=this.initSize.x/t,e.y=this.initSize.y/t,console.log(this.position.x+this.viewSize.x/2),this.position.x=i.x-e.x/2,this.position.y=i.y-e.y/2,console.log(this.position.x+this.viewSize.x/2),this.viewSize.x=e.x,this.viewSize.y=e.y},i}(e,o.environment),o.collisions=function(t,e){var i={},o=t.utils;i.centerDistance={setBounding:function(t,e){h(t,{radius:e})},methods:{checkCollision:function(t){var e=o.distance(this,t),i=h(this).radius+h(t).radius;return i>=e?!0:n}}},i.boundingBox={setBounding:function(t,e,i,n,o){s(t,e,i,n,o)},methods:{checkCollision:function(t){var n=this;return i.centerDistance.checkCollision.call(n,t)?!!e.find(s(t),function(t){return c(t,n)}):!1}}},i.utils={};var s=i.utils.boundingBox=function(t,i,n,o,s){return e.isUndefined(i)||(h(t,{box:{width:i,height:n,offsetLength:o,theta:s}}),h(t,{radius:a(t)})),r(t)},r=i.utils.boundingBoxPoints=function(t){var e,i=h(t).box,n=i.theta+t.angle,s=[];return e=o.relativePoint(t,n,i.offsetLength),s[0]=o.relativePoint(e,n-90,i.width/2),s[3]=o.relativePoint(e,n+90,i.width/2),s[1]=o.relativePoint(s[0],n-180,i.height),s[2]=o.relativePoint(s[3],n-180,i.height),s},a=i.utils.boundingRadiusFromBox=function(t){for(var e=r(t),i=0,n=0;e.length>n;n+=1){var s=o.distance(e[n],t);s>i&&(i=s)}return i},c=i.utils.pointIsInsideMatter=function(t,e){if(h(e).box!==n){var i=h(e).box,s=o.distance(t,e),r=o.angle(e,t);r-=i.theta+e.angle;var a=o.relativePoint(n,r,s),c=i.offsetLength-i.height,u=i.offsetLength,l=i.width/2,d=-i.width/2;return a.x>=c&&u>=a.x&&a.y>=d&&l>=a.y}h(e).radius!==n};i.utils.bounce=function(t,e){var i=o.angle(t,e),n=i+(i-t.v.angle())-180,s=Math.abs((t.v.magnitude()*(t.mass-e.mass)+2*e.mass*e.v.magnitude())/(t.mass+e.mass));t.v.magnitude()>0&&(t.v.angle(n>360?n-360:n),t.v.magnitude(s))};var u="_bounding",h=i.utils.bounding=function(t,i){return e.isUndefined(i)?e.isUndefined(t[u])&&(t[u]={}):t[u]=e.extend(t[u]||{},i),t[u]};return i}(freebody,e),o.Matter=function(t,e,i){var n=function(e){var i=this;return i.angle=0,t.Body.call(i,e),i};return e.extend(n.prototype,t.Body.prototype,i.Events,{collision:function(t){var i=this;return e.isFunction(i.checkCollision)&&i.checkCollision(t)?(i.trigger("collision",t),t.trigger("collision",i),o.hub.trigger("collision",i,t),!0):!1},collide:function(){}}),n}(freebody,e,i),o.gamePiece=function(t,e,i){var n=function(){var n={},o=function(t){return this.options=i.defaults(t,o.defaults),e.call(this,this.options),this.display=this._create.call(this),this.display.underlying=this,i.isFunction(this._setBounding)&&this._setBounding.call(this),this._setupEvents(),this};return i.extend(o.prototype,e.prototype),n.defaults=function(t){return o.defaults=t,n},n.methods=function(t){return i.extend(o.prototype,t),n},n.display=function(t){return o.prototype._create=t,n},n.events=function(t){return o.prototype._setupEvents=function(){var e=this;i.each(t,function(t,n){i.isString(t)&&(t=e[t]),e.on(n,t)})},n},n.collisions=function(e,s){var r=t.collisions[e];return r&&i.extend(o.prototype,r.methods,{_setBounding:function(){s.call(this,r.setBounding)}}),n},n.construct=function(){return o},n.create=function(t){return new n.construct(t)},n};return n}(o,o.Matter,e,Kinetic),o.KineticCamera=function(t,e,i){var s=function(e,n){t.call(this),this.stage=new i.Stage({container:e,width:n&&n.width||1e3,height:n&&n.height||750}),this._displayLayers={},this._setupTracking()};e.extend(s.prototype,t.prototype,{renderLayer:function(t){var i=this,n=i._layers[t],o=i._displayLayers[t];n&&(o||(o=i._addLayer(t)),e.each(n,function(t){i._addObjectToLayer(t,o),i.drawMatter(t)}),o.draw())},_addLayer:function(t){var e=new i.Layer;return e.name=t,this._displayLayers[t]=e,this.stage.add(e),e},_addObjectToLayer:function(t,e){t.display.layer!=e.name&&(e.add(t.display),t.display.layer=e.name)},_setupTracking:function(){var t,e,i,s=this,a={};a.touchstart=function(i){var n=r(i),s=n.underlying;o.hub.trigger("touchstart",i,s),o.selected=e=s,!i.handled&&s&&s.trigger&&s.trigger("touchstart",i),t=!0},a.touchmove=function(i){t&&(o.hub.trigger("touchmove",i,e),!i.handled&&e&&e.trigger&&e.trigger("touchmove",i))},a.touchend=function(i){o.hub.trigger("touchend",i,e),!i.handled&&e&&e.trigger&&e.trigger("touchend",i),o.selected=e=n,t=!1},a.scale=function(t){var e=s.scale*(1+t);e>.15&&2>e&&(s.zoom(e),o.hub.trigger("camera:zoom",e))},s.stage&&(s.stage.on("mousedown",a.touchstart),s.stage.on("mousemove",a.touchmove)),document.addEventListener("mouseup",a.touchend),document.addEventListener("mousewheel",function(t){a.scale(t.wheelDeltaY/1440)}),o.hub.on("touchstart",function(t,e){if(e&&t.ctrlKey&&t.shiftKey)s.follow(e),t.handled=!0;else if(t.ctrlKey&&!t.shiftKey){s.following=n;var r=s.position.x,a=s.position.y;s.position.x=t.layerX/s.scale+r-400/s.scale,s.position.y=t.layerY/s.scale+a-300/s.scale,o.hub.trigger("camera:center",s),t.handled=!0}else t.shiftKey&&!t.ctrlKey&&(i={x:t.layerX,y:t.layerY},t.handled=!0)}),o.hub.on("touchmove",function(t){i!==n&&t.shiftKey&&s&&(s.position.x+=(i.x-t.layerX)/s.scale,s.position.y+=(i.y-t.layerY)/s.scale,i.x=t.layerX,i.y=t.layerY,o.hub.trigger("camera:pan",s),t.handled=!0)}),o.hub.on("touchend",function(){i=n})}});var r=function(t){var e=t&&t.targetNode;if(e)for(;"Layer"!=e.parent.nodeType;)e=e.parent;return e};return s}(o.CameraBase,e,Kinetic),o.playback=function(t,i){var s,r=t.requestAnimationFrame,a={progress:!1,render:!1,physics:!1},c=!1,u={};return u.progress=function(t){a.progress||(s=r(u.progress)),a.physics||(i.trigger("playback:advance:before"),o.environment.advance(t-(o.time||t)),o.time=t,i.trigger("playback:advance")),a.render||o.camera===n||(i.trigger("playback:render:before"),o.camera.render(),i.trigger("playback:render"))},u.start=function(t){t?u.pause():u.unpause(),u.progress(),c=!0,i.trigger("playback:start")},u.step=function(t){a.progress=!0,o.time===n&&(o.time=+new Date),t=t!==n?t:1e3/60,u.progress(o.time+t),i.trigger("playback:step")},u.pause=function(t){t?(t.progress!==n&&(a.progress=t.progress),t.render!==n&&(a.render=t.render),a.physics=t.physics!==n?t.physics:!0):a.physics=!0,i.trigger("playback:pause")},u.unpause=function(t){t?(t.progress!==n&&(a.progress=t.progress),t.render!==n&&(a.render=t.render),a.physics=t.physics!==n?t.physics:!1):a.physics=!1,o.time=+new Date,i.trigger("playback:unpause")},u.stop=function(){s&&t.cancelAnimationFrame(s),o.time=n,c=!1,i.trigger("playback:stop")},u.toggle=function(){u.isPaused()?u.unpause():u.pause()},u.isPaused=function(){return!!e.some(e.values(a),function(t){return t})},u}(this||window,o.hub),o}(this||window,_,Backbone);